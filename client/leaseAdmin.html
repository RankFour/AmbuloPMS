<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/fontawesome/all.min.css">
    <link rel="stylesheet" href="/css/fonts.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/leaseAdmin.css">
    <title>Manage Leases</title>
</head>
<body>
    <div class="overlay" id="overlay"></div>

    <div id="sidebarContainer"></div>

    <!-- Main White Card Wrapper -->
    <div class="main-card-wrapper">
    <div class="container">
        <!-- Lease List View -->
        <div id="listView">
            <div class="header">
                <h1>Lease Management System</h1>
                <button class="btn btn-primary" onclick="showCreateView()">
                    <span>+</span> Create New Lease
                </button>
            </div>

            <!-- Filters -->
            <div class="card">
                <div class="card-body">
                    <div class="filters">
                        <div class="form-group">
                            <label class="form-label">Filter by Status</label>
                            <select class="form-select" id="filterStatus" onchange="applyFilters()">
                                <option value="">All Statuses</option>
                                <option value="ACTIVE">Active</option>
                                <option value="EXPIRED">Expired</option>
                                <option value="TERMINATED">Terminated</option>
                                <option value="PENDING">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Search Tenant</label>
                            <input type="text" class="form-input" id="filterTenant" placeholder="Enter tenant name..." oninput="applyFilters()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Search Property</label>
                            <input type="text" class="form-input" id="filterProperty" placeholder="Enter property name..." oninput="applyFilters()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date Filter</label>
                            <input type="date" class="form-input" id="filterDate" onchange="applyFilters()">
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>

            <!-- Lease Table -->
            <div class="card">
                <div class="table-container">
                    <table class="table" id="leaseTable">
                        <thead>
                            <tr>
                                <th>Lease ID</th>
                                <th>Tenant</th>
                                <th>Property</th>
                                <th>Lease Period</th>
                                <th>Status</th>
                                <th>Monthly Rent</th>
                                <th>Next Due</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leaseTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                    <div id="emptyState" class="empty-state hidden">
                        <h3>No leases found</h3>
                        <p>Create your first lease or adjust your filters</p>
                        <button class="btn btn-primary" onclick="showCreateView()">Create New Lease</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form View (Create/Edit) -->
        <div id="formView" class="hidden">
            <div class="header">
                <h1 id="formTitle">Create New Lease</h1>
                <div>
                    <button class="btn btn-secondary" onclick="cancelForm()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveLease()" id="saveBtn">
                        <span id="saveText">Save Lease</span>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="tabs">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="details">
                            üìã Lease Details
                        </button>
                        <button class="tab-btn" data-tab="financial">
                            üí∞ Financial Terms
                        </button>
                        <button class="tab-btn" data-tab="rules">
                            üìú Rules & Conditions
                        </button>
                        <button class="tab-btn" data-tab="notes">
                            üìù Notes & Files
                        </button>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Lease Details Tab -->
                    <div id="detailsTab" class="tab-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Tenant *</label>
                                <select class="form-select" id="tenantId" required>
                                    <option value="">Select a tenant</option>
                                    <option value="1">John Smith (john@email.com)</option>
                                    <option value="2">Sarah Johnson (sarah@email.com)</option>
                                    <option value="3">Mike Davis (mike@email.com)</option>
                                    <option value="4">Lisa Wilson (lisa@email.com)</option>
                                    <option value="5">Robert Chen (robert@email.com)</option>
                                </select>
                                <div class="error-message" id="tenantId-error"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Property *</label>
                                <select class="form-select" id="propertyId" required>
                                    <option value="">Select a property</option>
                                    <option value="1">Sunset Apartments - Unit 2A</option>
                                    <option value="2">Downtown Plaza - Office 301</option>
                                    <option value="3">Garden View Complex - Unit 1B</option>
                                    <option value="4">Ocean Breeze Tower - Unit 5C</option>
                                    <option value="5">City Center Mall - Shop 12</option>
                                </select>
                                <div class="error-message" id="propertyId-error"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-input" id="startDate" required>
                                <div class="error-message" id="startDate-error"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" class="form-input" id="endDate" required>
                                <div class="error-message" id="endDate-error"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Lease Status</label>
                                <select class="form-select" id="status">
                                    <option value="PENDING">Pending</option>
                                    <option value="ACTIVE">Active</option>
                                    <option value="EXPIRED">Expired</option>
                                    <option value="TERMINATED">Terminated</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Terms Tab -->
                    <div id="financialTab" class="tab-content hidden">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly Rent *</label>
                                <input type="number" class="form-input" id="monthlyRent" required min="0" step="0.01" placeholder="Enter amount">
                                <div class="error-message" id="monthlyRent-error"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Frequency</label>
                                <select class="form-select" id="paymentFrequency">
                                    <option value="Monthly">Monthly</option>
                                    <option value="Quarterly">Quarterly</option>
                                    <option value="Semi-Annual">Semi-Annual</option>
                                    <option value="Annual">Annual</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Quarterly Tax (%)</label>
                                <input type="number" step="0.1" class="form-input" id="quarterlyTax" min="0" max="100" placeholder="0.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Security Deposit (months)</label>
                                <input type="number" class="form-input" id="securityDeposit" min="0" placeholder="Number of months">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Advance Payment (months)</label>
                                <input type="number" class="form-input" id="advancePayment" min="0" placeholder="Number of months">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Late Fee (%)</label>
                                <input type="number" step="0.1" class="form-input" id="lateFee" min="0" max="100" placeholder="0.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Grace Period (days)</label>
                                <input type="number" class="form-input" id="gracePeriod" min="0" placeholder="Number of days">
                            </div>
                        </div>
                    </div>

                    <!-- Rules & Conditions Tab -->
                    <div id="rulesTab" class="tab-content hidden">
                        <div class="form-row">
                            <div class="checkbox-group">
                                <input type="checkbox" id="isSecurityRefundable" checked>
                                <label for="isSecurityRefundable">Security Deposit is Refundable</label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="checkbox-group">
                                <input type="checkbox" id="advanceForfeited">
                                <label for="advanceForfeited">Advance Payment Forfeited on Early Termination</label>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Auto-Termination Period (months)</label>
                                <input type="number" class="form-input" id="autoTerminationMonths" min="0" placeholder="Months of non-payment">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Termination Trigger Days</label>
                                <input type="number" class="form-input" id="terminationTriggerDays" value="61" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cancellation Notice (days)</label>
                                <input type="number" class="form-input" id="noticeCancelDays" min="0" placeholder="Days notice required">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Renewal Notice (days)</label>
                                <input type="number" class="form-input" id="noticeRenewalDays" min="0" placeholder="Days notice required">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rent Increase on Renewal (%)</label>
                                <input type="number" step="0.1" class="form-input" id="rentIncreaseRenewal" min="0" max="100" placeholder="0.0">
                            </div>
                        </div>
                    </div>

                    <!-- Notes & Files Tab -->
                    <div id="notesTab" class="tab-content hidden">
                        <div class="form-group" style="margin-bottom: 32px;">
                            <label class="form-label">Additional Notes</label>
                            <textarea class="form-input textarea" id="notes" placeholder="Enter any additional information about this lease..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contract Documents</label>
                            <div class="upload-area" onclick="handleFileUpload()">
                                <div style="font-size: 48px; margin-bottom: 16px;">üìÑ</div>
                                <p style="font-weight: 600; margin-bottom: 8px;">Click to upload contract files</p>
                                <p style="color: #6b7280; font-size: 12px;">PDF, DOC, DOCX, or image files accepted</p>
                            </div>
                            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" multiple style="display: none;">
                            <div id="uploadedFiles" class="uploaded-files"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detail View -->
        <div id="detailView" class="hidden">
            <div class="header">
                <div>
                    <h1 id="detailTitle">Lease Details</h1>
                    <p id="detailSubtitle" style="color: rgba(255,255,255,0.8); font-size: 16px;"></p>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="showListView()">‚Üê Back to List</button>
                    <button class="btn btn-primary" onclick="editCurrentLease()">Edit Lease</button>
                </div>
            </div>

            <div class="detail-grid">
                <div>
                    <!-- Basic Information -->
                    <div class="card">
                        <div class="card-body">
                            <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 20px; font-weight: 700;">Basic Information</h3>
                            <div class="info-grid" id="basicInfo"></div>
                        </div>
                    </div>

                    <!-- Financial Terms -->
                    <div class="card">
                        <div class="card-body">
                            <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 20px; font-weight: 700;">Financial Terms</h3>
                            <div class="info-grid" id="financialInfo"></div>
                        </div>
                    </div>

                    <!-- Rules & Conditions -->
                    <div class="card">
                        <div class="card-body">
                            <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 20px; font-weight: 700;">Rules & Conditions</h3>
                            <div class="info-grid" id="rulesInfo"></div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="card" id="notesCard" style="display: none;">
                        <div class="card-body">
                            <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 20px; font-weight: 700;">Additional Notes</h3>
                            <p id="leaseNotes" style="white-space: pre-wrap; line-height: 1.6; color: #4b5563;"></p>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div>
                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-body">
                            <div class="sidebar-section">
                                <h3>Quick Actions</h3>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button class="btn btn-primary" onclick="editCurrentLease()"><i class="fa-solid fa-pen"></i> Edit Lease</button>
                                    <button class="btn btn-success" onclick="generateContract()"><i class="fa-solid fa-file"></i> Generate Contract</button>
                                    <button class="btn btn-warning" onclick="sendReminder()"><i class="fa-solid fa-bell"></i> Send Payment Reminder</button>
                                    <button class="btn btn-danger" onclick="terminateLease()"><i class="fa-solid fa-x"></i> Terminate Lease</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Status -->
                    <div class="card">
                        <div class="card-body">
                            <div class="sidebar-section">
                                <h3>Payment Information</h3>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="info-label">Next Due Date</span>
                                        <span id="nextDueDate" class="info-value"></span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="info-label">Amount Due</span>
                                        <span id="amountDue" class="info-value"></span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="info-label">Payment Status</span>
                                        <span class="status-badge status-active">Current</span>
                                    </div>
                                    <button class="btn btn-primary" style="margin-top: 12px;" onclick="viewPaymentHistory()">
                                        View Payment History
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-body">
                            <div class="sidebar-section">
                                <h3>Recent Activity</h3>
                                <div class="notification-item notification-info">
                                    <span style="color: #3b82f6;">üí≥</span>
                                    <div>
                                        <p style="font-size: 12px; font-weight: 600; color: #1e40af;">Payment Received</p>
                                        <p style="font-size: 11px; color: #3b82f6;">2 days ago</p>
                                    </div>
                                </div>
                                <div class="notification-item notification-success">
                                    <span style="color: #10b981;">üìÖ</span>
                                    <div>
                                        <p style="font-size: 12px; font-weight: 600; color: #065f46;">Lease Renewed</p>
                                        <p style="font-size: 11px; color: #10b981;">1 week ago</p>
                                    </div>
                                </div>
                                <button style="background: none; border: none; color: #667eea; font-size: 12px; cursor: pointer; margin-top: 12px;" onclick="viewAllActivity()">
                                    View All Activity ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Documents -->
                    <div class="card">
                        <div class="card-body">
                            <div class="sidebar-section">
                                <h3>Documents</h3>
                                <div id="documentsList" style="display: flex; flex-direction: column; gap: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8fafc; border-radius: 6px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span>üìÑ</span>
                                            <span style="font-size: 12px; font-weight: 500;">Lease Agreement.pdf</span>
                                        </div>
                                        <button class="action-btn" onclick="downloadDocument('lease-agreement')" title="Download">‚¨áÔ∏è</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8fafc; border-radius: 6px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span>üìã</span>
                                            <span style="font-size: 12px; font-weight: 500;">Property Inspection.pdf</span>
                                        </div>
                                        <button class="action-btn" onclick="downloadDocument('property-inspection')" title="Download">‚¨áÔ∏è</button>
                                    </div>
                                </div>
                                <button style="background: none; border: none; color: #667eea; font-size: 12px; cursor: pointer; margin-top: 12px;" onclick="uploadNewDocument()">
                                    + Upload New Document
                                </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 16px; color: #ef4444;">Confirm Deletion</h3>
            <p style="margin-bottom: 24px; color: #6b7280;">Are you sure you want to delete this lease? This action cannot be undone.</p>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-secondary" onclick="hideDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">Delete Lease</button>
            </div>
        </div>
    </div>

    <!-- Cancel Form Modal -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 16px; color: #f59e0b;">Unsaved Changes</h3>
            <p style="margin-bottom: 24px; color: #6b7280;" id="cancelModalMessage">
                Are you sure you want to cancel? Any unsaved changes will be lost.
            </p>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-secondary" onclick="hideCancelModal()">Continue Editing</button>
                <button class="btn btn-warning" onclick="confirmCancel()">Discard Changes</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div style="font-weight: 600;" id="toastTitle">Success!</div>
        <div style="font-size: 12px; color: #6b7280; margin-top: 4px;" id="toastMessage">Operation completed successfully.</div>
    </div>
    
    <script src="/javascript/leaseAdmin.js"></script>
    <script src="/javascript/sidebar.js"></script>
</body>
</html>